# 不具合発生原因の分析報告 (Post Mortem)

なぜ「Chromeストアで2.0.0と表示されているのに、中身が1.6.1のまま」という事象が、何度も繰り返されたのか分析しました。

## 結論: 自動化スクリプトの OS 不適合とビルド未実施

最大の原因は **「更新用スクリプト(`update_extension.ps1`)が、現在の Linux 環境では動作していなかったこと」** です。

### 詳細な要因

1.  **PowerShellスクリプトへの依存**
    *   本プロジェクトの更新手順は `EXTENSION_UPDATE_GUIDE.md` で「鉄の掟」として定義されており、`scripts/update_extension.ps1` の実行が必須とされていました。
    *   しかし、現在のあなたの環境は **Linux** です。
    *   先ほどの調査コマンド (`which pwsh`) の結果、`pwsh` (PowerShell) はインストールされていませんでした。
    *   つまり、**更新スクリプトは一度も正常に動いておらず、単にスキップされていた** 可能性が高いです。

2.  **ソースコードとビルド成果物の乖離 (Stale Build)**
    *   以前の対応で、`package.json` や `constants.ts` (ソースコード) は正しく `2.0.0` に書き換えられていました。
    *   しかし、スクリプトが動かないため、**コンパイル (`npm run build`)** が行われませんでした。
    *   結果、`dist/` フォルダの中身は **数日前の v1.6.1 (Dev v39.1.15) のまま** 残っていました。
    *   この「古い中身」をZIP詰めしてストアに提出してしまったため、「表示は2.0.0だが、動かすと1.6.1」という現象が発生しました。

3.  **確認プロセスの不備**
    *   `dist/manifest.json` や `dist/main.js` の中身を直接確認せずに、「ソースを直したから大丈夫」と判断してしまっていました。

## 今後の対策

今回、`v2.0.2` の作成にあたり、以下の手順を手動で確実に実行しました。

1.  `npm run build` を明示的に実行 (PowerShellを経由せず直接実行)。
2.  `dist/main.js` 内のバージョン文字列が `v2.0.2` になっていることを `grep` コマンドで物理的に確認。
3.  その上で ZIP/TarGz アーカイブを作成。

**推奨:** 今後は Linux 環境用に `scripts/update_extension.sh` (Bashスクリプト) を作成するか、常に手動で `npm run build` を行うことをルール化する必要があります。
