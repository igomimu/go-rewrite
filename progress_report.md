# プロジェクト現状報告・考察 (Status Report & Analysis)

**作成日:** 2025-12-19
**報告者:** Gemini (Antigravity)

## 1. 事実 (Facts)

### 実装済みの機能
1.  **碁盤編集**: 石の配置（Simple Mode）、手数の記録（Numbered Mode）、履歴操作（Undo/Redo）。
2.  **自動検出**: 同じ場所への着手（衝突）を検知し、凡例用データを作成するロジック。
3.  **エクスポート時の自動切替**:
    - **画面上**: 常に「手数（例: 11）」を表示。編集作業の利便性を優先。
    - **画像出力時**: 自動的に「ラベル（例: A）」へ切り替え、フッターに凡例「11 [ A ]」を追加。
    - これにより、ユーザーは手動でモードを切り替える必要がなくなりました。

### 現状の挙動 (Current Behavior)
- **ケース**: 初期配置の「白石」がある地点に、手順として「黒11」を打った場合。
- **画面**: 「黒11」が表示される。
- **出力画像**: 「黒石」の上に「A」と表示される。（黒11が描画されているため）

---

## 2. 考察・課題 (Analysis & Thoughts)

### 「配石を消さずに見せる」という要望への解釈
ユーザー（PM）の「配石を消さずに見せる」という指摘から、現在の出力結果には以下の問題があると考えられます。

- **問題点**: 画像出力時に「最新の着手（黒石）」が描画されてしまっているため、**その下に元々あった「初期配置（白石）」が隠れて見えなくなっている**。
- **あるべき姿**: 詰碁の問題図としては、**「初期配置（白石）」が見えている状態で、その地点にラベル「A」が振られている** べきである。
- **凡例の意味**: 「11 [ A ]」という凡例は、「11手目は、図中のA（白石がある場所）に打ちました」と読むのが自然である。

### 技術的な修正方針
現在のエクスポート処理（`handleExport` / `performExport`）は、**「最新の盤面状態」** を描画してからラベルを上書きしています。これを以下のように変更する必要があります。

1.  **描画ロジックの変更**: エクスポート時、その地点が「初期配置との衝突（Setup Collision）」である場合、**11手目の黒石を描画せず、0手目の白石（初期配置）のみを描画** し、そこにラベル「A」を乗せる。
2.  **結果**: 出力画像は「白石にA」となり、初期配置が保たれる。凡例で「11の手順」を補足する形となる。

### 結論
現在の実装は「ラベルの自動化」までは成功していますが、「石そのものの視覚的な優先順位」の制御が、詰碁作成の文脈（初期配置優先）と合致していません。次はこの描画ロジックの修正が必要です。
