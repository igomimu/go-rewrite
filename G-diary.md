# Global Memory
- **Reading Records**: Stored in `C:/Users/lucky/OneDrive/Super-Data-Station/Books` (Markdown format). Always check here for book queries.

# 2025-12-19
- **Label and Symbol Modes**: Implemented Setup Mode tweaks, Label Mode (A, B, C...) and Symbol Mode (Triangle, Circle, Square, Cross).
- **Numbered Mode Refinements**:
    - Disabled double-click color toggle.
    - Forced Black color on mode activation.
    - Added Undo logic (remove last stone) for Right-Click and Delete key.
- **SGF Export**: Fixed bug where natural captures were exported as `AE` tags. Added `LB`, `TR`, `CR`, `SQ`, `MA` support.
- **Hidden Move Legend**: Implemented support for Manual Labels. Fixed issue where footer/labels were missing due to unpassed props. Added **Auto-Detection for Setup Stones** (collisions with initial state now appear automatically as `(Init)`).
    - **Update v32.0**: Switched to "Diff-based Detection".
    - **Update v33.1**:
        - **凡例の分離**: 盤面との間隔を広げ(80px)、背景マスクを追加することで、盤の罫線と凡例が重ならないように完全に分離しました。
        - **ハイブリッド凡例ロジック**: 
            - **数字同士の重複**: 「10 [ 6 ]」表記。盤面表記は常に **数字(10)** です（操作盤・出力画像共通）。
            - **配石との重複**: 「11 [ A ]」表記。盤面表記は常に **数字(11)** です（「11はAの場所である」と凡例で示します）。
        - **サイズ調整**: 凡例の石と数字を盤面の石と同じ定義(Radius 18.4, Font 26)に合わせて完全一致させました。
- **ダブルクリック色変更**:
    - **手数モード**: 最後に打った石をダブルクリックすると白黒が反転します。
    - **配石(標準)モード**: 既にある石をダブルクリックすると、その石の色が反転し、手持ちの石の色もその色に変わります。
- **UI簡略化**: 自動検出により手動ラベルが不要になったため、ツールボタン（●/A/★）を削除して画面をすっきりさせました。
- **Double-Click Color Swap**:
    - **Numbered Mode**: Toggles last placed stone color.
    - **Stone (Simple) Mode**: Double-clicking an existing stone toggles its color immediately and updates the active tool color to matched the toggled color.
- **UI Simplification**: Removed Manual Tool Mode buttons (Stone/Label/Symbol) to reduce clutter, as Auto-Detection handles labeling needs.
- **Double-Click Color Swap**: In Numbered Mode, double-clicking the last placed stone toggles its color (Black/White).
- **UI Restoration**: Restored missing Tool Mode buttons (Stone/Label/Symbol).
- **UI Restoration**: Restored missing Tool Mode buttons (Stone/Label/Symbol).
- **2024-12-19**: Refined 'Hidden Move Legend' visibility. 
    - Legend is now **hidden** on the operation board (live view).
    - Legend is **automatically shown** only during image export (along with 'Label Mode' A/B display).
    - Fixed `handleExport` and `handleExportSelection` logic to handle this temporary state switching reliably.
    - Resolved build errors in `App.tsx`.
- **2024-12-20**:
    - **Pass Feature**: Added a 'Pass' button (✋) next to navigation controls. Records a pass move (increments number, toggles color, no board change).
    - **Fixes**: Corrected Setup Mode double-click and drag behavior to propagate changes across history, preventing phantom 'A' labels.
    - **Export**: Exported images now accumulate all stones placed throughout history. Setup stones and earlier moves are prioritized. Stones are never removed (captures are ignored in the figure view), ensuring the complete sequence is visible.
    - **Export**: Fixed an issue where the legend would cut off the bottom row of the board image. Adjusted height calculation to ensure the legend expands the image size rather than consuming it.
    - **Export**: Reduced vertical spacing around the legend (Gap: 40px, Padding: 30px) to make the layout more compact.
    - **SGF Save**: Changed default filename to **Empty** (Blank) to allow users to type their desired name immediately without deleting text.
    - **Legend Fix**: Updated auto-detection logic to display **ALL** moves associated with a label in the legend (e.g., if 10 and 14 are at 'A', the legend will show `10 [ A ]` and `14 [ A ]`).
    - **Export Layout**: Implemented **dynamic line wrapping**.
        - Instead of extending the width, the legend now automatically wraps to the next line if it exceeds the board's width.
        - Added logic to explicitly **re-flow** legend items in the exported image, ensuring correct layout even when cropping from a large board.
    - **Compact Legend Grouping**:
        - Multiple moves at the same location (e.g., 10 and 14 at A) are now grouped into a single line: `10, 14, 15 [ A ]` (displayed as sequential stones), effectively compacting the vertical space.
        - **Flow Layout**: Implemented dynamic position calculation for legend items to handle variable widths (e.g., grouped stones) correctly, preventing overlap that occurred with fixed grid layout.
        - Corrected render order to ensure labels like "Triangle" are enclosed in brackets properly: `[ (Triangle) ]`.

- **2024-12-21**:
    - **石の操作ロジック変更**:
        - **初期配置モード**: 
            - **左クリック**: 黒石配置 / 既存石削除。
            - **右クリック**: 白石配置 / 既存石削除。
        - **手順入力モード**:
            - **左クリック**: 数字石配置 / 最後の手番なら削除(Undo)。
            - **右クリック**: 最後の手番削除(Undo)。入力は不可。

- **2026-01-05**:
    - **UI復旧**: App.tsx のレンダリング不具合（碁盤消失・ツールバー重複）を修正するため、安定バックアップからファイルを復元しました。
    - **UI改善**: ツールバーの整理を行い、ナビゲーションボタン（|< << < > >> >|）を碁盤下のメニューバーに移動しました。
    - **印刷設定機能**: 
        - タイトル、ヘッダー、フッター等の表示/非表示切替機能を追加しました。
        - **バグ修正**: 印刷プレビュー時にマウスホバーで「変な四角」が表示される問題を修正しました（`GoBoard`に`readOnly`モードを追加）。
    - **緊急修正 - 更新反映問題**:
        - `src/utils/treeUtils.ts` がバックグラウンドプロセスによりロックされ、空ファイル(0 byte)になっていた問題を特定・修正しました。
        - **treeUtilsV2.ts**: ロックされたファイルを迂回するため、新規ファイル `treeUtilsV2.ts` を作成し、ゲーム木ロジックを再実装しました。
        - **App.tsxの修復**: 
            - インポート先を `treeUtilsV2` に変更。
            - ビルドエラーの原因となっていた構文エラー（括弧不足）と型エラー（implicit any, missing imports）を修正しました。
            - レガシーな履歴管理（`redoStack`, `setHistory`）を廃止し、新しいTree構造に適したロジックに完全移行しました。
- **2026-01-06**:
    - **音声入力AI強化**: `voice-input` に `Right Shift` (AI指示モード) を追加し、Ollama `qwen2.5` を用いたプロンプト生成機能を実装しました。
    - **GORewrite v37.2**:
        - **白番開始機能**: 手順入力モードで「①」ボタンを右クリックまたは左クリックして「白①」から開始できるようになりました。設定は保存されます。
        - **SGFドラッグ＆ドロップ改善**: SGFファイルだけでなく、SGFのテキストデータを直接ブラウザへドラッグ＆ドロップして読み込めるようにしました。
        - **UI改善**: 「記号」ドロップダウンの幅を縮小、右クリックメニューの抑制、ナビゲーションボタン（進む）の有効化ロジック修正。
        - **重要なお知らせ**: Chrome拡張機能として使用する場合、`npm run dev` ではなく **`npm run build`** を行ってから拡張機能をリロードする必要があることを確認しました。
        - **印刷不具合修正**: 「ファイル全体」印刷時に白紙になる問題を修正（全手順データの取得を保証）。段位表記設定がアラビア数字に戻っていた問題を修正し、漢数字（初段、二段...）に戻しました。
        - **印刷不具合修正 (再)**: 段位表記（漢数字）のロジックを確実に復元しました。また、入力が既に「2段」のような形式になっている場合でも正しく「二段」と変換されるように対応しました。
        - **名前・結果表記の改善**: 
            - プレイヤー名に含まれる段位（例: User 3段）も漢数字に変換されるようにしました。
            - 結果（%RE%）の表記を日本語化しました（例: B+R → 黒中押し勝ち, 0.5 → 半目勝ち, 1.5 → 1目半勝ち, 10 → 10目勝ち）。
        - **SVG背景修正**: Word等でSVGを貼り付けた際、透明背景が黒くなってしまう問題（黒石が見えなくなる）を防ぐため、強制的に白背景の矩形(`<rect>`)を挿入するようにしました。
        - **凡例（隠れた手）の表示修正**: エクスポート時に凡例（[1]のような手数の説明）が表示されなくなっていた問題を修正しました（画面上で非表示にしていても出力データには含めるようにロジックを再構築しました）。
        - **バージョン更新**: 更新確認を行いやすくするため、バージョン番号を v37.3 に引き上げました。
- **2026-01-07**:
    - **エージェント同期環境の強化**:
        - **一括Gitステータス確認**: `GORewrite`, `voice-input` など全プロジェクトのGit状態を一瞬で確認するスクリプトを導入しました。
        - **セットアップ自動化**: Legion (Win/WSL) および YogaPro (WSL) 用の自動セットアップスクリプトを更新し、OneDrive上の設定ファイルへの永続リンク（シンボリックリンク/Junction）を作成するようにしました。これにより設定の手間が一度きりになりました。
        - **用語定義**: どの環境でも意図が伝わるよう、共通ルールを整備しました。
        - **ストレス軽減策**: エージェントが常に日本語で応答するように強力な指示をルール冒頭に追加しました。
    - **SGF分岐対応**: SGFファイルの分岐読み込み機能を実装完了しました。
    - **拡張機能更新完了 (v39.1.4)**: 拡張機能のアップデート手順（スクリプト実行等）を定義し、最新版への更新を実施しました。

- **2026-01-10**:
    - **[Feature] 枝分かれ手順（分岐）のUI実装**:
        - **Ghost Stones**: 盤上の分岐点に半透明の石を表示し、クリックでその変化図へ移動できるようにしました。
        - **Navigation Bar**: ツールバーに「分岐: A B...」ボタンを追加し、キーボード/マウスなしでも分岐を選択可能にしました。
        - **Logic Restoration**: 以前の作業で失われていたUIロジックを復元・強化しました。
    - **[Fix] プロジェクト定義の修正**:
        - `task.md` と `G-diary.md` において、本プロジェクトが「詰碁アプリ」ではなく「GORewrite（棋譜再生・印刷・SGFエディタ）」であることを明記し、混同されていたSanity関連の記述をLegacy区分に移動しました。
    - **[Release] v39.1.8**:

- **2026-01-13**:
    - **[Fix] SVG Export Regression**:
        - **Background Fix**: SVGエクスポート時に背景が透明（黒）になる問題を修正しました。`viewBox` 座標に基づいた正しい `<rect>` を挿入するように `exportUtils.ts` を修正しました。
        - **Collision Logic Fix**: 初期配置石が衝突判定から除外されていた問題を修正し、凡例に正しく「[ 初期配置 ]」と表示されるようにしました。
    - **[Info] バージョン表記ルール**:
        - **Development Version** (e.g., v39.1.9): 開発中の詳細な内部バージョン。`App.tsx` や `G-diary` で使用。
        - **Public Version** (e.g., v1.3): ストア公開用のメジャーバージョン。`manifest.json` で使用。
    - **[Important] 拡張機能更新手順**:
        - 拡張機能を更新・リロードする際は、必ず **`npm run build`** を実行して `dist` フォルダを再生成する必要があります（`dev` サーバーでは反映されません）。
    - **[Release] v39.1.9 (Public v1.3)**:
        - 上記修正を含むリリース版を作成しました。
    - **[Fix] Hybrid Legend & Export Labels (v39.1.12 / Public v1.4)**:
        - 凡例のハイブリッドロジック（初期配置石上の着手はABCラベル、既存石上の着手は数字参照）を実装しました。
        - エクスポート画像において、ラベル（"A"等）が石の描画順序により隠れてしまう問題を修正しました（オーバーレイ石に直接テキストを指定）。
        - これにより、凡例と盤上の石の双方で「A」などのラベルが正しく同期して表示されます。

- **2026-01-15**:
    - **[Fix] Version Unification (v1.5.0 / v39.1.13)**:
        - 混乱していたバージョン表記を統一しました (v1.5.0).
    - **[Feature] Translation Support (v1.6.0)**:
        - **i18n Support**: 英語・中国語への翻訳機能を追加しました (v1.6.0として提出済み).
        - **Note**: このバージョンにはSVGエクスポート時に背景が反転する不具合が含まれている可能性があります.

- **2026-01-16**:
    - **[Fix] SVG/GIF Export Hardening (v1.6.1 / v39.1.23)**:
        - **Critical Fix**: SVGエクスポート時に、特定のブラウザ環境（ダークモード拡張機能など）において色が反転したり背景が黒くなる問題を、強力なスタイル強制 (`color-scheme: light`, `filter: none`) により修正しました。
        - **Rollback**: 安定性重視のため、実験的機能であったGIF出力機能は削除しました。本バージョンは「翻訳機能(v1.6.0) + エクスポート修正」の安定版となります。

- **2026-01-16**:
    - **[New Feature] GIF Export (v1.5.1 / v39.1.15)**:
        - 棋譜の着手手順をアニメーションGIFとしてエクスポートする機能を実装しました。
        - `gifshot` ライブラリを採用し、クライアントサイドでのGIF生成を実現。
        - ツールバーにエクスポートボタンを追加し、生成中の進捗（プログレスバー）を表示するようにしました。

- **2026-01-17**:
    - **[Release] v2.0.0 (Public Release)**:
        - **Major Update**: 正式メジャーバージョン v2.0.0 をリリースしました。
        - **Version Unification**: 開発版バージョンも v2.0.0 に統一しました。
        - **Features**: 
            - 翻訳機能 (i18n support)
            - 強力なSVGエクスポート修正 (Dark Mode fix)
            - 安定性重視のためGIF生成機能は除外されています。
        - **Artifact**: `GORewrite_v2.0.0.zip` を作成しました。

- **2026-01-17 (LizzieYZY Customization)**:
    - **[Task] 画像保存形式のデフォルト化**:
        - LizzieYZYにおいて、画像保存時のファイル形式初期値を PNG から **JPG** に変更しました。
        - 公式ソースコード (v2.5.3) をベースに `LizzieFrame.java` を修正し、ビルドを行いました。
        - **Deployment**: `C:\Users\lucky\Documents\LizzieYzy-2.5.9\LizzieYzy-2.5.9` 内の `lizzie-yzy2.5.9-shaded.jar` を、今回ビルドしたカスタムjar（v2.5.3ベースだが実質同等）に置き換えました。
        - **Backup**: 元のjarファイルは同ディレクトリに `lizzie-yzy2.5.9-shaded.jar.bak` として保存済みです。
        - **Cleanup**: ビルドに使用した一時環境（Maven, JDK, ソースコード）を削除しました。
